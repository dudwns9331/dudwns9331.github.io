<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> 11장 컴포넌트 성능 최적화 -ZeroJun's Blog </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="리액트를 다루는 기술 - velopert- 11장 컴포넌트 성능 최적화"> <meta name="keywords" content="11장 컴포넌트 성능 최적화, ZeroJun's Blog, React,"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="ZeroJun's Blog" property="og:site_name" /> <meta content="11장 컴포넌트 성능 최적화" property="og:title" /> <meta content="article" property="og:type" /> <meta content="리액트를 다루는 기술 - velopert" property="og:description" /> <meta content="https://dudwns9331.github.io/react/2021/07/06/react11/" property="og:url" /> <meta content="2021-07-06T14:33:01+00:00" property="article:published_time" /> <meta content="https://dudwns9331.github.io/about/" property="article:author" /> <meta content="https://dudwns9331.github.io/assets/img/posts/book.jpg" property="og:image" /> <meta content="React" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="11장 컴포넌트 성능 최적화" /> <meta name="twitter:url" content="https://dudwns9331.github.io/react/2021/07/06/react11/" /> <meta name="twitter:description" content="리액트를 다루는 기술 - velopert" /> <link rel="stylesheet" href="https://dudwns9331.github.io/assets/css/main.css" /> <!-- <link rel="stylesheet" href="https://dudwns9331.github.io/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="https://dudwns9331.github.io/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="https://dudwns9331.github.io/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="https://dudwns9331.github.io/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="https://dudwns9331.github.io/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="https://dudwns9331.github.io/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'https://dudwns9331.github.io' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="https://dudwns9331.github.io/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="https://dudwns9331.github.io/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="https://dudwns9331.github.io/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="https://dudwns9331.github.io/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="https://dudwns9331.github.io/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="https://dudwns9331.github.io/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="https://dudwns9331.github.io/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="https://dudwns9331.github.io/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="https://dudwns9331.github.io/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="https://dudwns9331.github.io/assets/js/search.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- Maker widget --> <!-- <script> (function(d, h, m) { var js, fjs = d.getElementsByTagName(h)[0]; if (d.getElementById(m)) { return; } js = d.createElement(h); js.id = m; js.onload = function() { window.makerWidgetComInit({ position: "left", widget: "ofeeof264otl2l5g-zspk40eq2gaomj2n-higi2qphmveubksi" }); }; js.src = "https://makerwidget.com/js/embed.js"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "dhm"); </script> --> <!-- buy me a coffeee --> <!-- <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="sujaykundu" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="right" data-x_margin="10" data-y_margin="10" ></script> --> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body><nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">ZeroJun's Blog</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="https://dudwns9331.github.io/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="https://dudwns9331.github.io/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="https://dudwns9331.github.io/blog" >Blog</a > </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" href="https://dudwns9331.github.io/get-started"> Get Started </a> </li> --> <!-- <li class="nav-item"> <a class="nav-link" id="olvy-target"> What's New </a> </li> --> <!-- <li class="nav-item"> <a class="nav-link" href="https://dudwns9331.github.io/styleguide"> Styleguide </a> </li> --> <!-- <li class="nav-item"> <button id="olvy-target" class="btn btn-dark">What's New</button> </li> --> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <!-- <li class="nav-item" style="margin-top: 5px; padding-right: 20px"> <a class="header__checkout snipcart-checkout"> <svg width="31" height="27" viewBox="0 0 31 27" fill="none" xmlns="http://www.w3.org/2000/svg" > <path d="M1.10512 0.368718C0.560256 0.368718 0.118164 0.812066 0.118164 1.35848C0.118164 1.9049 0.560256 2.34824 1.10512 2.34824H4.90887L8.30138 18.4009C8.43503 19.0053 8.83085 19.5079 9.32946 19.5041H25.7788C26.3005 19.5118 26.7799 19.0375 26.7799 18.5143C26.7799 17.9911 26.3006 17.5168 25.7788 17.5245H10.1315L9.71003 15.545H27.095C27.5371 15.5412 27.9547 15.2048 28.0511 14.7718L30.354 4.87412C30.4825 4.29933 29.9852 3.67172 29.3979 3.66786H7.21171L6.6771 1.15221C6.58329 0.71276 6.15921 0.368652 5.7107 0.368652L1.10512 0.368718ZM7.623 5.64746H12.7634L13.2569 8.61674H8.25005L7.623 5.64746ZM14.7785 5.64746H20.9881L20.4946 8.61674H15.2719L14.7785 5.64746ZM23.0031 5.64746H28.1537L27.4649 8.61674H22.5097L23.0031 5.64746ZM8.67181 10.5963H13.5862L14.0797 13.5656H9.29919L8.67181 10.5963ZM15.6009 10.5963H20.1656L19.6721 13.5656H16.0944L15.6009 10.5963ZM22.1807 10.5963H27.0023L26.3135 13.5656H21.6872L22.1807 10.5963ZM12.6197 20.164C10.8141 20.164 9.32979 21.6525 9.32979 23.4632C9.32979 25.2739 10.8141 26.7624 12.6197 26.7624C14.4252 26.7624 15.9095 25.2739 15.9095 23.4632C15.9095 21.6525 14.4252 20.164 12.6197 20.164ZM22.4892 20.164C20.6837 20.164 19.1994 21.6525 19.1994 23.4632C19.1994 25.2739 20.6837 26.7624 22.4892 26.7624C24.2948 26.7624 25.7791 25.2739 25.7791 23.4632C25.7791 21.6525 24.2948 20.164 22.4892 20.164ZM12.6197 22.1435C13.3586 22.1435 13.9356 22.7222 13.9356 23.4632C13.9356 24.2042 13.3586 24.7829 12.6197 24.7829C11.8807 24.7829 11.3037 24.2042 11.3037 23.4632C11.3037 22.7222 11.8807 22.1435 12.6197 22.1435ZM22.4892 22.1435C23.2282 22.1435 23.8052 22.7222 23.8052 23.4632C23.8052 24.2042 23.2282 24.7829 22.4892 24.7829C21.7503 24.7829 21.1733 24.2042 21.1733 23.4632C21.1733 22.7222 21.7503 22.1435 22.4892 22.1435Z" fill="#ff7901" class="header__checkout-fill" ></path> </svg> <span class="snipcart-items-count"></span> <span class="snipcart-total-price"></span> </a> </li> --> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox" /> </li> </ul> </nav> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus /> <input class="search-form__submit" type="submit" value="search" /> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div> <div class="container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">11장 컴포넌트 성능 최적화</h1> <h4 class="post-meta">리액트를 다루는 기술 - velopert</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name" ><a href="https://dudwns9331.github.io/blog/authors/yeongjun" >yeongjun</a ></span > </span > at <time datetime="2021-07-06 14:33:01 +0000" itemprop="datePublished" >Jul 6, 2021</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/react/2021/07/06/react11/" ></span> <div class="post-categories"> Category : <a href="/blog/categories/React" >React</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="https://dudwns9331.github.io/assets/img/posts/book.jpg" alt="" /> <br /> <br /> <h2 id="2021-07-06">2021-07-06</h2> <h1 id="11장-컴포넌트-성능-최적화">11장 컴포넌트 성능 최적화</h1> <p><br /></p> <p>10장에서 만든 애플리케이션은 불편하지 않다. 하지만 데이터가 무수히 많아진다면 애플리케이션이 느려지는것을 체감할 수 있을 정도로 지연이 생긴다.</p> <ol> <li>많은 데이터 렌더링하기</li> <li>크롬 개발자 도구를 통한 성능 모니터링</li> <li>React.memo를 통한 컴포넌트 리렌더링 성능 최적화</li> <li>onToggle과 onRemove가 새로워지는 현상 방지하기</li> <li>react-virtualized 사용한 렌더링 최적화</li> </ol> <p>다음과 같은 순서로 진행되고 정리한다.</p> <p><br /></p> <hr /> <h3 id="111-많은-데이터-렌더링하기">11.1 많은 데이터 렌더링하기</h3> <p><br /></p> <p><strong>App.js 중 일부분</strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 많은 데이터 렌더링하기</span>
<span class="kd">function</span> <span class="nx">createBulkTodos</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">2500</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">id</span><span class="p">:</span> <span class="nx">i</span><span class="p">,</span>
      <span class="na">text</span><span class="p">:</span> <span class="s2">`할 일 </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
      <span class="na">checked</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>createBulkTodos() 라는 함수를 만들어 할일에 대한 배열을 2500개까지 생성하도록한다. id는 1부터 2500까지 인덱스를 넣어주고 <code class="language-plaintext highlighter-rouge">백틱</code> 기호를 사용하여 <code class="language-plaintext highlighter-rouge">${i}</code> 를 통해서 인덱스를 텍스트에 넣어주도록 한다. 그리고 배열을 반환하도록 한다.</p> <p><br /></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// useState(함수이름) 을 통해서 처음 렌더링 시에 createBulkTodos가 실행되게 한다.</span>
<span class="kd">const</span> <span class="p">[</span><span class="nx">todos</span><span class="p">,</span> <span class="nx">setTodos</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="nx">createBulkTodos</span><span class="p">);</span>
</code></pre></div></div> <p>다음으로 state를 생성하는 코드에서 <code class="language-plaintext highlighter-rouge">todos</code> 배열안에 <code class="language-plaintext highlighter-rouge">createBulkTodos</code>가 반환하는 배열이 들어가도록 <code class="language-plaintext highlighter-rouge">useState(createBulkTodos)</code>를 통해서 컴포넌트가 처음 렌더링 될 때 함수가 실행되도록 함수의 이름만 넣어주도록 한다.</p> <p><br /></p> <hr /> <h3 id="112-크롬-개발자-도구를-통한-성능-모니터링">11.2 크롬 개발자 도구를 통한 성능 모니터링</h3> <p><br /></p> <p>성능을 분석하는데 있어서 느려졌다는 느낌으로는 충분하지 않다. 따라서 정확히 몇 초가 걸리는지 확인해야 하는데, 크롬 개발자 도의 <code class="language-plaintext highlighter-rouge">Performance</code> 탭을 사용하여 측정하면 된다. 개발자 도구의 녹화 버튼을 눌러 동작한 후 그 동작에 대한 성능을 측정하도록 한다.</p> <p><br /></p> <p align="center"> <img src="/assets/img/posts/React/performance-tap.png" width="750px" height="350px" /> </p> <p>성능 분석 결과에 Timings를 열어 보면 각 시간대에 컴포넌트의 어떤 작업이 처리되었는지를 확인할 수 있다.</p> <p><br /></p> <hr /> <h3 id="113-느려지는-원인-분석">11.3 느려지는 원인 분석</h3> <p><br /></p> <p>컴포넌트는 다음과 같은 상황에서 리렌더링된다.</p> <ol> <li>자신이 전달받은 props가 변경될 때</li> <li>자신의 state가 바뀔 때</li> <li>부모 컴포넌트가 리렌더링 될 때</li> <li>forceUpdate 함수가 실행될 때</li> </ol> <p>지금 프로젝트의 상황은 state가 변경되면서 리스트에 있는 컴포넌트들이 모두 리렌더링하는 상황으로 리렌더링이 불필요할 때는 방지해주는 작업이 필요하다.</p> <p><br /></p> <hr /> <h3 id="114-reactmemo를-사용하여-컴포넌트-성능-최적화">11.4 React.memo를 사용하여 컴포넌트 성능 최적화</h3> <p><br /></p> <p>컴포넌트 리렌더링을 방지할 때는 <code class="language-plaintext highlighter-rouge">shouldComponentUpdate</code>라는 라이프사이클을 사용하면 된다. 함수형 컴포넌트에서는 라이프사이클 메서드를 사용할 수 없다. 따라서 <code class="language-plaintext highlighter-rouge">React.memo</code>라는 함수를 사용하도록 한다. 컴포넌트의 props가 바뀌지 않았다면, 리렌더링하지 않도록 설정하여 함수형 컴포넌트의 리렌더링 성능을 최적화해 줄 수 있다.</p> <p><strong>TodoListItem.js</strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// React.memo로 감싸줌으로써 todo, onRemove, onToggle이 바뀌지 않으면 리렌더링을 하지 않는다.</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span>
  <span class="nx">TodoListItem</span><span class="p">,</span>
  <span class="p">(</span><span class="nx">prevProps</span><span class="p">,</span> <span class="nx">nextProps</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">prevProps</span><span class="p">.</span><span class="nx">todo</span> <span class="o">===</span> <span class="nx">nextProps</span><span class="p">.</span><span class="nx">todo</span>
<span class="p">);</span>
</code></pre></div></div> <p><br /></p> <hr /> <h3 id="115-ontoggle-onremove-함수가-바뀌지-않게-하기">11.5 onToggle, onRemove 함수가 바뀌지 않게 하기</h3> <p><br /></p> <p>현재 프로젝트에서는 <code class="language-plaintext highlighter-rouge">React.memo</code>를 사용하는 것만으로는 컴포넌트 최적화가 끝나지 않는다. 현재 프로젝트에서는 <code class="language-plaintext highlighter-rouge">todos</code> 배열이 업데이트되면 <code class="language-plaintext highlighter-rouge">onRemove</code>와 <code class="language-plaintext highlighter-rouge">onToggle</code> 함수도 새롭게 바뀌기 때문이다.</p> <p><code class="language-plaintext highlighter-rouge">onRemove</code>와 <code class="language-plaintext highlighter-rouge">onToggle</code> 함수는 배열 상태를 업데이트 하는 과정에서 최신 상태의 <code class="language-plaintext highlighter-rouge">todos</code>를 참조하기 때문에 <code class="language-plaintext highlighter-rouge">todos</code> 배열이 바뀔 때마다 함수가 새로 만들어진다. 이렇게 함수가 계속 만들어지는 상황을 방지하는 방법은 <code class="language-plaintext highlighter-rouge">useState</code> 함수형 업데이트 기능을 사용하는 것과 <code class="language-plaintext highlighter-rouge">useReducer</code>를 사용하는 것이다.</p> <p><br /> <br /></p> <h4 id="usestate의-함수형-업데이트">useState의 함수형 업데이트</h4> <p>기존에는 setTodos 함수를 사용할 때 새로운 상태로 파라미터를 넣어 주었다. setTodos를 사용할 때는 새로운 상태를 파라미터로 넣는 대신, 상태 업데이트를 어떻게 할지 정의해 주는 업데이트 함수를 넣을 수 있다. 이를 <code class="language-plaintext highlighter-rouge">함수형 업데이트</code>라고 부른다.</p> <p><br /></p> <p><strong>example.js</strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[</span><span class="nx">number</span><span class="p">,</span> <span class="nx">setNumber</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="c1">// prevNumbers는 현재 number 값을 가리킨다.</span>
<span class="kd">const</span> <span class="nx">onIncrease</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">setNumber</span><span class="p">((</span><span class="nx">prevNumber</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">prevNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
  <span class="p">[]</span>
<span class="p">);</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">setNumber(number + 1)</code> 하는 것이 아니라, 위 코드 처럼 어떻게 업데이트할지 정의해 주는 업데이트 함수를 넣어준다. 그러면 <code class="language-plaintext highlighter-rouge">useCallback</code>을 사용할 때 두 번째 파라미터로 넣는 배열에 <code class="language-plaintext highlighter-rouge">number</code>를 넣지 않아도 된다.</p> <p><br /></p> <p><strong>App.js 중 일부</strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">onRemove</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">((</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setTodos</span><span class="p">((</span><span class="nx">todos</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">todos</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">todo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">id</span><span class="p">));</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div></div> <p>다음과 같이 함수들을 <code class="language-plaintext highlighter-rouge">todos(이전 상태 값)</code>을 파라미터로 받아서 해당 값에 대한 연산을 수행한 후 상태를 업데이트 하도록 하고 뒤에 들어가는 배열은 비운다.</p> <p><br /></p> <p><strong><em>** 프로덕션 모드로 구동 시</em></strong></p> <div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">$</span><span class="w"> </span><span class="n">yarn</span><span class="w"> </span><span class="n">build</span><span class="w">
</span><span class="o">$</span><span class="w"> </span><span class="n">yarn</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">serve</span><span class="w">
</span><span class="o">$</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="n">build</span><span class="w">
</span></code></pre></div></div> <p><br /></p> <hr /> <h4 id="usereducer-사용하기">useReducer 사용하기</h4> <p><strong>App-Reduce.js</strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useCallback</span><span class="p">,</span> <span class="nx">useReducer</span><span class="p">,</span> <span class="nx">useRef</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">TodoInsert</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">components/Todo/TodoInsert</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">TodoList</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">components/Todo/TodoList</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">TodoTemplate</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">components/Todo/TodoTemplate</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// 많은 데이터 렌더링하기</span>
<span class="kd">function</span> <span class="nx">createBulkTodos</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">2500</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">id</span><span class="p">:</span> <span class="nx">i</span><span class="p">,</span>
      <span class="na">text</span><span class="p">:</span> <span class="s2">`할 일 </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
      <span class="na">checked</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 상태 업데이트 로직</span>
<span class="kd">function</span> <span class="nx">todoReducer</span><span class="p">(</span><span class="nx">todos</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">INSERT</span><span class="dl">'</span><span class="p">:</span> <span class="c1">// 새로 추가</span>
      <span class="c1">// { type : 'INSERT', todo : { id : 1, text : 'todo', checked: false } }</span>
      <span class="k">return</span> <span class="nx">todos</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">todo</span><span class="p">);</span>

    <span class="k">case</span> <span class="dl">'</span><span class="s1">REMOVE</span><span class="dl">'</span><span class="p">:</span> <span class="c1">// 제거</span>
      <span class="c1">// { type : 'REMOVE', id : 1 }</span>
      <span class="k">return</span> <span class="nx">todos</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">todo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

    <span class="k">case</span> <span class="dl">'</span><span class="s1">TOGGLE</span><span class="dl">'</span><span class="p">:</span> <span class="c1">// 토글</span>
      <span class="c1">// { type : 'TOGGLE', id : 1}</span>
      <span class="k">return</span> <span class="nx">todos</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">todo</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">todo</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">action</span><span class="p">.</span><span class="nx">id</span> <span class="p">?</span> <span class="p">{</span> <span class="p">...</span><span class="nx">todo</span><span class="p">,</span> <span class="na">checked</span><span class="p">:</span> <span class="o">!</span><span class="nx">todo</span><span class="p">.</span><span class="nx">checked</span> <span class="p">}</span> <span class="p">:</span> <span class="nx">todo</span>
      <span class="p">);</span>

    <span class="nl">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">todos</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">todos</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useReducer</span><span class="p">(</span><span class="nx">todoReducer</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">createBulkTodos</span><span class="p">);</span>

  <span class="c1">// 고윳값으로 사용될 id</span>
  <span class="c1">// ref를 사용하여 변수 담기</span>
  <span class="kd">const</span> <span class="nx">nextId</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="mi">2501</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">onInsert</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">((</span><span class="nx">text</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">id</span><span class="p">:</span> <span class="nx">nextId</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span>
      <span class="nx">text</span><span class="p">,</span>
      <span class="na">checked</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">INSERT</span><span class="dl">'</span><span class="p">,</span> <span class="nx">todo</span> <span class="p">});</span>
    <span class="nx">nextId</span><span class="p">.</span><span class="nx">current</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// nextId 1씩 더하기</span>
  <span class="p">},</span> <span class="p">[]);</span>

  <span class="kd">const</span> <span class="nx">onRemove</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">((</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">REMOVE</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span> <span class="p">});</span>
  <span class="p">},</span> <span class="p">[]);</span>

  <span class="kd">const</span> <span class="nx">onToggle</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">((</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">TOGGLE</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span> <span class="p">});</span>
  <span class="p">},</span> <span class="p">[]);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">TodoTemplate</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">TodoInsert</span> <span class="nx">onInsert</span><span class="o">=</span><span class="p">{</span><span class="nx">onInsert</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">TodoList</span> <span class="nx">todos</span><span class="o">=</span><span class="p">{</span><span class="nx">todos</span><span class="p">}</span> <span class="nx">onRemove</span><span class="o">=</span><span class="p">{</span><span class="nx">onRemove</span><span class="p">}</span> <span class="nx">onToggle</span><span class="o">=</span><span class="p">{</span><span class="nx">onToggle</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/TodoTemplate</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">useReducer</code>를 사용할 때는 원래 두 번째 파라미터에 초기 상태를 넣어주어야 한다. 지금은 그 대신 두 번째 파라미터에 <code class="language-plaintext highlighter-rouge">undefined</code>를 넣고, 세 번째 파라미터에 초기 사앹를 만들어주는 함수인 <code class="language-plaintext highlighter-rouge">createBulkTodos</code>를 넣어주었다. 이렇게 하면 컴포넌트가 맨 청므 렌더링 할때만 <code class="language-plaintext highlighter-rouge">createBulkTodos</code> 함수가 호출된다.</p> <p><br /></p> <p><code class="language-plaintext highlighter-rouge">useReducer</code>를 사용하는 방법은 기존 코드를 많이 고쳐야 한다는 단점이 있지만, 상태를 업데이트하는 로직을 모아서 컴포넌트 바깥에 둘 수 있다는 장점이 있다.</p> <p><br /></p> <hr /> <h3 id="116-불변성의-중요성">11.6 불변성의 중요성</h3> <p><br /></p> <p>리액트 컴포넌트에서 상태를 업데이트할 때 불변성을 지키는 것은 매우 중요하다.</p> <p><strong>App.js</strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">onToggle</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">((</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setTodos</span><span class="p">((</span><span class="nx">todos</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">todos</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">todo</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">todo</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span> <span class="p">?</span> <span class="p">{</span> <span class="p">...</span><span class="nx">todo</span><span class="p">,</span> <span class="na">checked</span><span class="p">:</span> <span class="o">!</span><span class="nx">todo</span><span class="p">.</span><span class="nx">checked</span> <span class="p">}</span> <span class="p">:</span> <span class="nx">todo</span>
    <span class="p">)</span>
  <span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div></div> <p>기존 데이터를 수정할 때 직접 수정하지 않고 새로운 배열을 만든 다음에 새로운 객체를 만들어서 필요한 부분을 교체해 주는 방식으로 구현했다. 업데이트가 필요한 곳에서는 아예 새로운 배열 혹은 새로운 객체를 만들기 때문에 React.memo를 사용했을 때 props가 바뀌었는지 혹은 바뀌지 않았는지를 알아내서 리렌더링 성능을 최적화해 줄 수 있었다.</p> <p>이렇게 기존의 값을 직접 수정하지 않으면서 새로운 값을 만들어 내는 것은 <code class="language-plaintext highlighter-rouge">불변성을 지킨다</code> 라고 한다.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>

<span class="kd">const</span> <span class="nx">nextArrayBad</span> <span class="o">=</span> <span class="nx">array</span><span class="p">;</span> <span class="c1">// 배열을 복사하는 것이 아니라 똑같은 배열을 가리킨다.</span>
<span class="nx">nextArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array</span> <span class="o">===</span> <span class="nx">nextArrayBad</span><span class="p">);</span> <span class="c1">// 완전히 같은 배열이기 때문에 true</span>

<span class="kd">const</span> <span class="nx">nextArrayGood</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">array</span><span class="p">];</span> <span class="c1">// 배열 내부에 값을 모두 복사</span>
<span class="nx">nextArrayGood</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="nx">array</span> <span class="o">=</span> <span class="nx">nextArrayGood</span><span class="p">));</span> <span class="c1">// 다른 배열이기 때문에 false</span>

<span class="kd">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">foo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">value</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">nextObjectBad</span> <span class="o">=</span> <span class="nx">object</span><span class="p">;</span> <span class="c1">// 객체가 복사되지 않고, 똑같은 객체를 가리킨다.</span>
<span class="nx">nextObjectBad</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">nextObjectBad</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">object</span> <span class="o">===</span> <span class="nx">nextObjectBad</span><span class="p">);</span> <span class="c1">// 같은 객체이기 때문에 true</span>

<span class="kd">const</span> <span class="nx">nextObjectGood</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">object</span><span class="p">,</span> <span class="c1">// 기존에 있던 내용을 모두 복사해서 넣는다.</span>
  <span class="na">value</span><span class="p">:</span> <span class="nx">object</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">// 새로운 값을 덮어 쓴다.</span>
<span class="p">};</span>

<span class="nx">cosole</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">object</span> <span class="o">===</span> <span class="nx">nextObjectGood</span><span class="p">);</span> <span class="c1">// 다른 객체이기 때문에 false</span>
</code></pre></div></div> <p>불변성이 지켜지지 않으면 객체 내부의 값이 새로워져도 바뀐 것을 감지하지 못한다. 전개 연산자( . . . 문법)를 사용하여 객체나 배열 내부의 값을 복사할 때는 얕은 복사(shallow copy)를 하게 된다. 즉, 내부의 값이 완전히 새로 복사되는 것이 아니라 가장 바깥쪽에 있는 값만 복사된다. 따라서 내부의 값이 객체 혹은 배열이라면 내부의 값 또한 따로 복사해 주어야 한다.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">todos</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">checked</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">checked</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
<span class="p">];</span>

<span class="kd">const</span> <span class="nx">nextTodos</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">todos</span><span class="p">];</span>

<span class="nx">nextTodos</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">todos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">nextTodos</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// 아직까지는 똑같은 객체를 가리키고 있기 때문에 true</span>

<span class="nx">nextTodos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">nextTodos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
  <span class="na">checked</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">todos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">nextTodos</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// 새로운 객체를 할당해 주었기에 false</span>
</code></pre></div></div> <p>만약 객체 안에 있는 객체라면 불변성을 지키면서 새 값을 할당해야 하므로 다음과 같이 해 줘야 한다.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">nextComplexObject</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">ComplexObject</span><span class="p">,</span>
  <span class="na">objectInside</span><span class="p">:</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">ComplexObject</span><span class="p">.</span><span class="nx">objectInside</span><span class="p">,</span>
    <span class="na">enabled</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">complexObject</span> <span class="o">===</span> <span class="nx">nextComplexObject</span><span class="p">);</span> <span class="c1">// false</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">complexObject</span><span class="p">.</span><span class="nx">objectInside</span> <span class="o">===</span> <span class="nx">nextComplexObject</span><span class="p">.</span><span class="nx">objectInside</span><span class="p">);</span> <span class="c1">// false</span>
</code></pre></div></div> <p><br /></p> <hr /> <h3 id="117-todolist-컴포넌트-최적화하기">11.7 TodoList 컴포넌트 최적화하기</h3> <p>TodoList.js</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">TodoList</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">todos</span><span class="p">,</span> <span class="nx">onRemove</span><span class="p">,</span> <span class="nx">onToggle</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">TodoList</span><span class="p">);</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">TodoList</code>를 다음과 같이 수정한다. 위의 최적화 코드는 프로젝트 성능에 영향을 전혀 주지 않는다. 왜냐하면 <code class="language-plaintext highlighter-rouge">TodoList</code> 컴포넌트의 부모 컴포넌트인 <code class="language-plaintext highlighter-rouge">App</code> 컴포넌트가 리렌더링되는 유일한 이유가 <code class="language-plaintext highlighter-rouge">todos</code> 배열이 업데이트될 때이기 때문이다. 따라서 <code class="language-plaintext highlighter-rouge">TodoList</code> 컴포넌트는 불필요한 리렌더링이 발생하지 않는다. 하지만 <code class="language-plaintext highlighter-rouge">state</code>가 추가되어 해당 값들이 업데이트 될 때는 <code class="language-plaintext highlighter-rouge">TodoList</code> 컴포넌트가 불필요한 렌더링을 할 수 있기 때문에 <code class="language-plaintext highlighter-rouge">React.memo</code>를 통해서 최적화 해주었다.</p> <p><br /></p> <hr /> <h3 id="118-react-virtualized를-사용한-렌더링-최적화">11.8 react-virtualized를 사용한 렌더링 최적화</h3> <p><br /></p> <p>지금까지는 리액트 컴포넌트 리렌더링 성능을 최적화하는 방법을 알아보았다. 리렌더링 성능을 최적화할 때는 필요한 리렌더링만 하도록 설정하는게 좋을 것이다.</p> <p><br /></p> <p><code class="language-plaintext highlighter-rouge">react-virtualized</code> 를 사용하면 리스트 컴포넌트에서 스크롤되기 전에 보이지 않는 컴포넌트는 렌더링하지 않고 크기만 차지하게끔 할 수 있다. 그리고 만약 스크롤되면 해당 스크롤 위치에서 보여 주어야 할 컴포넌트를 자연스럽게 렌더링한다.</p> <div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">$</span><span class="w"> </span><span class="n">yarn</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">react</span><span class="o">-</span><span class="n">virtualized</span><span class="w">
</span></code></pre></div></div> <p><br /></p> <p>다음으로 각 항목의 크기와 전체 크기를 재어 TodoList를 수정하도록 한다.</p> <p><strong>TodoList.js</strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useCallback</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">TodoListItem</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./TodoListItem</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">components/Scss/TodoList.scss</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">List</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-virtualized</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">TodoList</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">todos</span><span class="p">,</span> <span class="nx">onRemove</span><span class="p">,</span> <span class="nx">onToggle</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">rowRenderer</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(</span>
    <span class="p">({</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">style</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="nx">todos</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">TodoListItem</span>
          <span class="nx">todo</span><span class="o">=</span><span class="p">{</span><span class="nx">todo</span><span class="p">}</span>
          <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">key</span><span class="p">}</span>
          <span class="nx">onRemove</span><span class="o">=</span><span class="p">{</span><span class="nx">onRemove</span><span class="p">}</span>
          <span class="nx">onToggle</span><span class="o">=</span><span class="p">{</span><span class="nx">onToggle</span><span class="p">}</span>
          <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">style</span><span class="p">}</span>
        <span class="sr">/</span><span class="err">&gt;
</span>      <span class="p">);</span>
    <span class="p">},</span>
    <span class="p">[</span><span class="nx">onRemove</span><span class="p">,</span> <span class="nx">onToggle</span><span class="p">,</span> <span class="nx">todos</span><span class="p">]</span>
  <span class="p">);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">List</span>
      <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">TodoList</span><span class="dl">"</span>
      <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mi">512</span><span class="p">}</span> <span class="c1">// 전체크기</span>
      <span class="nx">height</span><span class="o">=</span><span class="p">{</span><span class="mi">513</span><span class="p">}</span> <span class="c1">// 전체 높이</span>
      <span class="nx">rowCount</span><span class="o">=</span><span class="p">{</span><span class="nx">todos</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span> <span class="c1">// 항목 개수</span>
      <span class="nx">rowHeight</span><span class="o">=</span><span class="p">{</span><span class="mi">57</span><span class="p">}</span> <span class="c1">// 항목 높이</span>
      <span class="nx">rowRenderer</span><span class="o">=</span><span class="p">{</span><span class="nx">rowRenderer</span><span class="p">}</span> <span class="c1">// 항목을 렌더링할 때 쓰는 함수</span>
      <span class="nx">list</span><span class="o">=</span><span class="p">{</span><span class="nx">todos</span><span class="p">}</span> <span class="c1">// 배열</span>
      <span class="nx">style</span><span class="o">=</span> <span class="c1">// List에 기본 적용되는 outline 스타일 제거</span>
    <span class="sr">/</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">TodoList</span><span class="p">);</span>
</code></pre></div></div> <p>List 컴포넌트를 사용할 때는 해당 리스트의 전체 크기와 각 항목의 높이, 각 항목을 렌더링할 때 사용해야 하는 함수, 그리고 배열을 props로 넣어주어야 한다. 그러면 이 컴포넌트가 전달받은 props를 사용하여 자동으로 최적화 해준다.</p> <p><strong>TodoListItem</strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">MdCheckBoxOutlineBlank</span><span class="p">,</span>
  <span class="nx">MdCheckBox</span><span class="p">,</span>
  <span class="nx">MdRemoveCircleOutline</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-icons/md</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">cn</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">classnames</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">components/Scss/TodoListItem.scss</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">TodoListItem</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">todo</span><span class="p">,</span> <span class="nx">onRemove</span><span class="p">,</span> <span class="nx">onToggle</span><span class="p">,</span> <span class="nx">style</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">checked</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">todo</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">TodoListItem-virtualized</span><span class="dl">"</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">style</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">TodoListItem</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span>
          <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">cn</span><span class="p">(</span><span class="dl">'</span><span class="s1">checkbox</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">checked</span> <span class="p">})}</span>
          <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">onToggle</span><span class="p">(</span><span class="nx">id</span><span class="p">)}</span>
        <span class="o">&gt;</span>
          <span class="p">{</span><span class="nx">checked</span> <span class="p">?</span> <span class="o">&lt;</span><span class="nx">MdCheckBox</span> <span class="o">/&gt;</span> <span class="p">:</span> <span class="o">&lt;</span><span class="nx">MdCheckBoxOutlineBlank</span> <span class="o">/&gt;</span><span class="p">}</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">text</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">onRemove</span><span class="p">(</span><span class="nx">id</span><span class="p">)}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">MdRemoveCircleOutline</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">};</span>

<span class="c1">// React.memo로 감싸줌으로써 todo, onRemove, onToggle이 바뀌지 않으면 리렌더링을 하지 않는다.</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span>
  <span class="nx">TodoListItem</span><span class="p">,</span>
  <span class="p">(</span><span class="nx">prevProps</span><span class="p">,</span> <span class="nx">nextProps</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">prevProps</span><span class="p">.</span><span class="nx">todo</span> <span class="o">===</span> <span class="nx">nextProps</span><span class="p">.</span><span class="nx">todo</span>
<span class="p">);</span>
</code></pre></div></div> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0'; fjs.parentNode.insertBefore(js, fjs); })(document, 'script', 'facebook-jssdk'); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <!-- <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="https://dudwns9331.github.io/react/2021/07/06/react11/" data-size="large" data-layout="button" >Share</a> </div> --> <!-- Author box --> <div class="card"> <div class="card-header"> About YeongJun </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="https://dudwns9331.github.io/assets/img/authors/yeongjun.png" alt="YeongJun" /> </div> <div class="col-md-6"> <p class="author_bio">Hi I am YeongJun, a Web Developer and Designer.</p> <p>Email : dudwns1045@naver.com</p> <p>Website : http://gitbub.com/dudwns9331</p> <p class="profile-links"> <a class="social-link" href="https://github.com/dudwns9331" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://instagram.com/ahn0_jun" target="_blank"><i class="fab fa-instagram fa-fw"></i></a> </p> </div> </div> </div> </div> </div> <!--<div class="comments"><script> var disqus_config = function () { this.page.url = "https://dudwns9331.github.io/react/2021/07/06/react11/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/react/2021/07/06/react11"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement("script"); s.src = "https://https-dudwns9331-github-io.disqus.com/embed.js"; s.setAttribute("data-timestamp", +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript >Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </div>--> <!-- 댓글인데 지저분한 광고로 인해서 내림 --> <!-- <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "https://dudwns9331.github.io/react/2021/07/06/react11/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/react/2021/07/06/react11"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement("script"); s.src = "https://https-dudwns9331-github-io.disqus.com/embed.js"; s.setAttribute("data-timestamp", +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript >Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About yeongjun</div> <div class="card-body"> <p class="author_bio">강원대학교 컴퓨터공학과 컴퓨터과학전공 R.O.T.C 60th 127 학군단, 프론트엔드 개발 준비중 :D</p><!-- Place this tag where you want the github button to render. <a class="github-button" href="https://github.com/sujaykundu777/devlopr-jekyll" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star sujaykundu777/devlopr-jekyll on GitHub" >Star</a > --> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#React"></div> <li class="tag-head"> <a href="/blog/categories/React">React</a> </li> <a name="React"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="https://dudwns9331.github.io/">Home</a> </li> <li> <a href="https://dudwns9331.github.io/about">About</a> </li> <li> <a href="https://dudwns9331.github.io/blog">Blog</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"><!-- Mailchimp Newletters <form action="" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate > <div id="mc_embed_signup_scroll_footer"> <label for="mce-EMAIL_footer"> Signup for Weekly Email Newsletters :D</label > <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL_footer" placeholder="email address" required /> real people should not fill this in and expect good things - do not remove this or risk form bot signups <div style="position: absolute; left: -5000px" aria-hidden="true"> <input type="text" name="b_50bab1c85eae24ecfb0f68361_3a2dd721d0" tabindex="-1" value="" /> </div> <br /> <div class="clear"> <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe_footer" class="btn btn-lg btn-success" /> </div> </div> </form> --> </div><footer> <p> Powered by<a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll</a>.Hosted at <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script src="https://dudwns9331.github.io/assets/js/mode-switcher.js"></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> <!-- olvy releases --> <script> var OlvyConfig = { organisation: "devlopr", target: "#olvy-target", type: "sidebar", view: { showSearch: true, compact: true, showHeader: true, /* only applies when widget type is embed. you cannot hide header for modal and sidebar widgets */ showUnreadIndicator: true, unreadIndicatorColor: "#FFA13AFF", unreadIndicatorPosition: "top-right" } }; </script> <script type="text/javascript" src="https://app.olvy.co/script.js" defer="defer"></script> </body> </html>
